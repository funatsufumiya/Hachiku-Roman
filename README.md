# Hachiku - Windows で薙刀式v14集大成版 を使うスクリプト

[薙刀式 v14集大成版（仮）](http://oookaworks.seesaa.net/article/483714452.html#comment&gsc.tab=0) 2021年10月4日版を Autohotkey に実装しました。

### Hachiku.ahk

ディレクトリ source の下にあるファイルをすべて保存します。

Autohotkey をインストールし、ディレクトリ source にある Hachiku.ahk のスクリプトを実行してください。

Ahk2Exe.exe でコンパイルする場合は、Unicode版で出力してください。

# IME の設定

### 旧MS-IME

初期状態の設定のままでもそこそこ使えますが、次の設定を行うことをおすすめします。

IME 入力モード切替の通知  → オフ: 画面中央に表示する

キー設定： 半角+全角	→	[入力/変換文字なし]IMEオフ, [他]半英固定

### 新MS-IME

初期状態の設定で使います。

### ATOK

Hachiku.ahk にあるコメントをご覧ください。
また、トレイアイコンを右クリックして設定を選び、ATOK対応をチェックしてください。

# 独自機能

* 編集モードD+F+H、J+K+G、J+K+Vで、変換中の文字があれば確定し、なければそのまま所定の動作をします。
* 編集モードM+Comma+W、M+Comma+S、M+Comma+F で選択範囲にカッコを付けたあと、クリップボードは空になる。ダミーの空白も入らない。
* 固有名詞ショートカットのシフト面（スペース押下）を追加
* 固有名詞ショートカットを最大５組を切り替えられる。切り替えは M+Comma+1 で１番、M+Comma+2 で２番、など。

「固有名詞登録」画面が出ているときに切り替えると、登録内容がコピーされます。
(OK を押すと登録されます)

* スペースキーのリピートを設定できる

スペースキーを押しっぱなしで漢字変換が始まっても、シフト側文字のキーを押せば変換を取り消して文字が入力されます。

* 左右の小指シフトの機能を「英数」・「かな」から選べる
* 「後置シフト」を設定可能

# 動作確認

* Windows 10 Home version 20H2 64-bit + AutoHotkey (v1.1.33.10) + 新旧MS-IME あるいは ATOK 2017

Windows 10 version 2004 以降のバージョンでなければ記号、固有名詞ショートカットが正しく入力できないと思われます。

# 不具合

* IMEの設定変更をしなければ、編集モードや固有名詞の入力でIME 入力モード切替の通知が出る。

固有名詞ショートカットに半角・全角区別なく設定した文字を出力するために一旦、IMEをオフにしているためです。
MS-IMEをお使いでしたら、上の IME の設定を行うと消すことができます。

* リピート機能が、キーを上げることなく連打するようになっていない
* スタートメニューの検索、エクスプローラの検索では「選択範囲にカッコをつける」が正常に動作しない。
* スタートメニューの検索、エクスプローラの検索で入力した文字を確定しても色が変わらない。
* 記号入力、固有名詞ショートカットで不要な：（コロン）が入力されることがある。

IME に未確定の文字がないか調べられないときには、：（コロン）→エンター→前文字削除 を送っています。
それでまれに：（コロン）が削除されずに残ってしまうことがあります。

* キーの押したときに、変換せずにそのまま通ってしまうことがまれにある。

* (新MS-IME) かな変換中に英数入力に切り替え、確定しないでキーを押すと最初の文字が入力されない。

新MS-IME の仕様です。

# 参考

* [薙刀式 v14集大成版（仮）](http://oookaworks.seesaa.net/article/483714452.html#comment&gsc.tab=0)

## 固有名詞ショートカットの切り替え

固有名詞ショートカットを最大５組まで切り替えられます。切り替えは M+Comma+1 で１番、M+Comma+2 で２番、といった具合です。

「固有名詞登録」画面が出ているときに切り替えると、登録内容がコピーされます。
(OK を押すと登録されます)

## テストモードについて

将来この項目に修正・削除・追加があるかもしれませんが、ご容赦ください。

iniファイル（通常 Hachiku.ini）内を、
AdvancedMenu=1
として保存し、Hachikuを再起動すれば設定が追加されます。

このうち、「詳細」にある「文字キーによるシフトの適用範囲」はDvorakJ版薙刀式の仕様である、上から「真ん中」「真ん中」「左」をおすすめします。

## src¥KanaTable¥*.ahk で使えるキーや記号の書き方

ASCIIコード文字だけで定義するときは、Autohotkey の書き方に準じます。

http://ahkwiki.net/Send の特殊キー名一覧もご覧ください。

そのまま入力	0〜9 A〜Z -^@[]./ 全角文字

{確定}
{Enter} {Esc} {Space} {Tab} {BS} {Del} {Ins}
{Up} {Down} {Left} {Right}
{Home} {End} {PgUp} {PgDn}
など

ASCIIコード以外の文字があると、そこからは IME をオフにして残りを出力します。

{直接} の後は IME をオフにしてさらに無変換で出力します。これを固有名詞ショートカットの実装に使っています。

## 動作速度

* 最初の読み込み

２～３秒程度

* 英数、かなの普通の文字

通常 8 ms 以内、エクスプローラー 78 ms 以内。
(ローマ字の文字数によって変わる)

* 記号、固有名詞ショートカット

最大 0.7秒。
